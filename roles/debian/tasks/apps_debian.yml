---
#
#  Part of https://github.com/jaclu/ish-fstools
#
#  Copyright (c) 2025-2026: Jacob.Lundqvist@gmail.com
#
#  License: MIT
#
#  Install selected Debian apps
#

- name: List what will be installed
  debug:
    msg: "{{ ift_debian_packages | sort }}"
  run_once: true

- name: Remove packages listed in ift_debian_purges
  package:
    state: absent
    name: "{{ ift_debian_purges }}"

- name: Install selected packages
  package:
    state: present
    name: "{{ ift_debian_packages }}"

#
#  Debian specific file copying
#

- name: Install custom /etc/init.d/sshd, supporting iSH logging --  remote_src
  copy:
    remote_src: true
    src: "{{ d_repo_debian_role }}/files/etc/init.d/sshd"
    dest: "{{ d_init_ift }}/sshd"
    owner: root
    group: root
    mode: "0755"
  when: ansible_facts.os_family == 'Debian'
  notify: Restart sshd

- name: Install custom /etc/init.d/rc --  remote_src
  copy:
    remote_src: true
    src: "{{ d_repo_debian_role }}/files/etc/init.d/rc"
    dest: "{{ d_init_ift }}/rc"
    owner: root
    group: root
    mode: "0755"
  when: ansible_facts.os_family == 'Debian'

- name: "Install extras to /usr/local/bin  -- {{ initial_prep_remote_src_lbl }}"
  copy:
    remote_src: "{{ not initial_prep_old_ansible }}"
    mode: preserve
    src: "{{ d_repo_debian_role }}/files/usr_local_bin/"
    dest: /usr/local/bin/
  when: ansible_facts.os_family == 'Debian'

- name: "Install extras to /usr/local/sbin  -- {{ initial_prep_remote_src_lbl }}"
  copy:
    remote_src: "{{ not initial_prep_old_ansible }}"
    mode: preserve
    src: "{{ d_repo_debian_role }}/files/usr_local_sbin/"
    dest: /usr/local/sbin/
  when: ansible_facts.os_family == 'Debian'
