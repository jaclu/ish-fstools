---

#
#  Copyright (c) 2025: Jacob.Lundqvist@gmail.com
#
#  License: MIT
#
#  Installs basic sshd service
#

- name: " sshd - Create symbolic link in /etc/init.d"
  ansible.builtin.file:
    src: "{{ d_init_ift }}/sshd"
    dest: "{{ f_srvc_sshd }}"
    state: link

- name: " sshd - Check presence in runlevel: {{ ift_runlevel_sshd }}"
  ansible.builtin.stat:
    path: "/etc/runlevels/{{ ift_runlevel_autossh }}/{{ ift_runlevel_sshd }}"
  register: all_distros_sshd_check

- name: " sshd - Add to runlevel if needed"
  ansible.builtin.command: rc-update add sshd "{{ ift_runlevel_sshd }}"
  changed_when: true
  when: not all_distros_sshd_check.stat.exists

- name: " sshd - Set /etc/ssh/sshd_config Port: {{ ift_port_sshd | default(2022) }}"
  ansible.builtin.lineinfile:
    path: /etc/ssh/sshd_config
    regexp: '^\#Port '
    line: 'Port {{ ift_port_sshd | default(2022) }}  # Defined by ish-fstools'
  when: ift_port_sshd is defined and ift_port_sshd != ""
