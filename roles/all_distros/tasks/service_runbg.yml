---

#
#  Copyright (c) 2025: Jacob.Lundqvist@gmail.com
#
#  License: MIT
#
#  Installs runbg service
#

- name: " runbg - Install service"
  # become: true
  ansible.builtin.copy:
    remote_src: true
    src: "{{ d_repo_all_distros_role }}/files{{ d_init_d }}/runbg"
    dest: "{{ d_init_ift }}/"
    owner: root
    group: root
    mode: '0755'

- name: " runbg - Create symbolic link in /etc/init.d"
  ansible.builtin.file:
    src: "{{ d_init_ift }}/runbg"
    dest: "{{ service_runbg }}"
    state: link

- name: " runbg - Check presence in runlevel: {{ ift_runlevel_runbg }}"
  ansible.builtin.stat:
    path: "/etc/runlevels/{{ ift_runlevel_runbg }}/runbg"
  register: all_distros_runbg_check

- name: " runbg - Add to runlevel if needed"
  ansible.builtin.command: rc-update add runbg "{{ ift_runlevel_runbg }}"
  changed_when: true
  when: not all_distros_runbg_check.stat.exists
